\documentclass[twocolumn,10pt,a4paper]{jsarticle}
\input{include/preamble.tex}
\input{include/macro.tex}

\title{i-Cart miniとROSによる自立移動ロボットの開発}
\author{徳安一，西田健}
\date{}

\begin{document}
  \maketitle

\section{はじめに} \setcounters{0}
  我々CIR-KITは，九州工業大学工学部の学部生を中心としたロボット開発チームであり，屋内外の移動を行う福祉ロボットの開発に取り組んでいる．
  自律移動ロボットが人間の生活環境内で活動するにあたって必要とされる機能は安全性の確保を始めとして多くがあるが，
  本稿で報告するロボット（KIT-C5）はその中でも最も基本的な機能と考えられる，地図情報を元とした移動と障害物回避に焦点を当てて，
  チーム内の新人の技術習得を目的として開発を行ったものである．\\

\section{ロボットの構成} \setcounters{0}
  本ロボットでは，ハードウェアにi-Cart miniを，ソフトウェアにROS（Robot Operating System）を採用した． % TODO センサの話
  以下でそれぞれについて述べる．\\

\subsection{ハードウェア}
  i-Cart miniは筑波大学知能ロボット研究室T-frogプロジェクトにより開発された屋内外用の小型移動ロボットフレームで，
  これを用いることで最小構成の移動ロボットシステムを容易に構築することが出来る．
  また，オープンソースハードウェアであることも大きな特徴で，
  T-frogプロジェクトのウェブサイト\cite{icart}上で図面・部品リストが公開されている．

  i-Cart miniは2機のブラシレスモータにより駆動される独立二輪方式として設計されており，
  公開されている通りに組めば全長$423.50 \unit{mm}$，全幅$365.80 \unit{mm}$，全高$157 \unit{mm}$である．

  小型であることは運動性能の観点からは利点となるが，安全性の観点からは歩行者がロボットの存在に気づけない可能性があることや
  非常停止スイッチの取り付け位置が低くなることが問題点として考えられた．
  そのため本ロボットではi-Cart miniを立っている人間が身を屈めず触れられる高さ（$600 \unit{mm}$）まで延長し，そこに非常停止スイッチを設置することでこの問題を解決した．
  また，歩行者からの視認性を考えロボットを周囲の景色との対比から十分に目立つと考えられる赤色の外装で覆った．
  \refig{KIT-C5}に実際に競技会で運用したKIT-C5の外観を示す．\\

  \fig{H}{0.8}{figure/kit-c5.eps}{KIT-C5の外観}{KIT-C5}

\subsection{ソフトウェア}
  i-Cart miniは，二軸モータドライバTF-2MD3-R6と走行制御用プログラムYp-Spurを組み合わせて動作するように設計されている．
  Yp-Spurはi-Cart miniと同じく筑波大学知能ロボット研究室により開発されている移動ロボット用の走行制御プラットフォームで
  各モータドライバへの指示値をロボットの移動方向という形に抽象化する\cite{ypspur}．
  また，Yp-SpurにはROSと自然に協調するためのROSパッケージypspur\_ros\_bridgeが用意されている．

  本ロボットでは上記のYp-Spur，ypspur\_ros\_bridgeに加え，自己位置推定にROSのnavigationパッケージを利用した．% TODO 使ったソフトウェア多分他にもある

% TODO ここまで暫定。ただしキモい部分がいくつかあるので要修正

  URG運用に不可欠なLaserProc パッケージは，開発当初はKinetic Kame向けにリリースされていなかったために，代位手段を模索していたが，10月半ばにリリースがなされたので，これを使用して運用を行った.

\subsection{センサ}
  主センサとして当初より機体前部に設けたマウンタによって北洋電気製のURGを1基搭載して運用した．
  計画の上ではカメラ，後方URG，GPS測位モジュール，超音波センサなども検討したが，開発期間の都合上今回の採用は見送って大会に臨んだ.


二軸モータドライバTF-2MD3-R6によってブラシレスモータを駆動するのに加えて，オドメトリを同時に取得する. ある程度の処理能力のあるマシンによって得た環境地図の精度は，単一のセンサによるものであってもかなり優秀なものが得られた.
 これは，センサ類の数を省略して開発を進行するという決定の一因にもなっている.

 2.4 筐体

強度を担う部分はアルミフレームとボルト留めで構成されている. 運用に於いて，標準の構成要素に加えて，URG搭載用の自作マウンタを装備した.

これは，URGによって得られるデータが水平面方向にあることから，URGの高さ調整を可能とすること，また，複数の高さにおける水平面でデータを取得できるようにしたいと考えたためであった.
実際の運用においては，調整が煩雑に生ること，取付強度的に問題があることに加えて，重心と離れた点にセンサ類を搭載したことなどから振動が激しくデータに悪影響を及ぼすなど問題の多い構造となった.

 2.5 マシン

 一般的なラップトップを用いて ROS Kinetic Kame を運用した.

当初は旧式のラップトップを用いて運用していたが，URGによる環境地図の取得中に，著しい処理能力不足でシステムがダウンするおよび地図が正しく取れないという自体に陥り，急遽これを改めた.


\section{走行実験結果}

制作中のユニットテスト/実働試験では良好な結果を納めていたが,当日になっていろいろな問題が発生した. それらをここに記す.

 3.1 外装

当初の予定では，駆動部のみに重厚なカバーを施し，他の部分については極力省略していくことを構想していた.

また，降雨時の対策として，防雨版を施すことを予定していたが，時間の都合で省略されていた.



 被発見性/視認性の低さから現場での改修を行った.  プラダンボール板により外装をかさ増しして，開口部を閉塞した. センサ類/駆動部との干渉は可能な限り避けるという方針になった.

当日こそ晴れたが，試験日に雨の釣行が見られ，急遽防雨シート(ビニールの切れ端)を取り付けた次第がある.  当初の予定では，防雨版は標準で装備しておく予定だったが， 進捗の関係で叶わなかった.

 3.2走行特性

振動が激しかった. 石畳の上を走行する実験を欠いていたため，当日まで問題にならなかった点である. 特に種々の改造に於いてトップヘビー・前重心という状況になっていたことが状況を 悪化させた.

状況によっては，ピッチ方向に±5°ほどもブレが起こった. 揺動に従って,センサの返す値も激しく変動した.これについては，カウンターウェイトなどを配置してある程度まで対処可能である.


それにもかかわらず最終的なオドメトリ取得/地図作成は優秀な結果を出している.これはi-Cart mini 及び ROS Navigation を組み合わせた運用のポテンシャルを物語るものの一つであろう.

車体下部にバッテリを搭載しているが， 縁石や障害物を超える際にこれが引っかかって動けなくなる事態が頻発した. 改造が必要だと認められる.

 3.3 ソフトウェア

予め用意した環境地図を用いて即生きセンサからの情報を元に ROS Navigation により経路選択を行い，Publish されたトピックをUSB シリアル通信によって二軸モータドライバTF-2MD3-R6に指令値として渡すことができる.

特段の致命的なバグはなかったはずではあるが，前日に用意したデータとの差異/地図作成時のノイズが自己位置推定を破綻させるケースが多々あった.

また，ROS Navigation の運用に際して，主要開発メンバの大半が初心者であったということも手伝って，トラブルにも満たないエラーの対処にさえ混乱があった. いかにROS がユーザフレンドリーかつ一般性のあるシステムであったとしても，使用者の技能如何に於いては，スムーズな開発 / 運用を実現しがたいという場合もありうる.

地図作成に於いて，ところどころノイズと思われる点が地図内に発生，その点に治して回避動作をとっていると思われる動作が所々に見られた.

現場では，手動でノイズと思われる点に対して，画像編集ソフトによる訂正を加えた(白塗りをかけた).

根本的には，入るノイズを低減するために機体/センサの安定性を向上すること，ソフトウェア的なノイズ低減フィルタを設けるなどを設ける必要性などが感じられた.

起動手順における自動化が徹底していなかったために，起動順序が煩雑となっていた. 実際，本走行における失敗に付いては，人的過失による操作ミスの可能性が CIR-KIT 部内から指摘されている.

制作が当日まで継続されたということもあって，十分な調整および成熟が行えなかったことが悔やまれる.

4. 開発体制について

 4.1 開発参加者の熟練度
KIT-C5 は主に九州工業大学 CIR-KIT 所属の学部生によって制作された.

開発期間は，準備期間まで含めるとおおよそ三ヶ月程度である.

ROS システムについては筆者含め非常に不慣れであったため，開発の進行途中に ROS システムの勉強をやり直す必要性が度々発生していたが，同時に細部の実装については，低級工程をパッケージ導入という形で省略したうえで完了することが可能となったために，非常に開発を高速化できたという側面もある.

ROS システムへの習熟は重要であるが，如何せん時間がかかる. しかしながら ROS エコシステムに共通の部分へ理解が深まれば，他のパッケージについても共通に扱える部分は多少なりとあるはずであるから，これらは少なくとも ロボットに関わる団体に所属することがわかった時点ですでに習得を開始するべき要因の一つである. 言い換えれば，これらの要素は一度十分に身につけてしまえば，それからの開発速度は，少なくとも共通に扱える部分については，格段に向上できるスキルの一つである.

今後は，開発参加者について，早い時期から ROS の実用を勧めたい. 筆者自身も，ROS を運用する中でこそ発見できたことが多々あった.
 チュートリアルの消化はもちろんのこと，行いたいタスクとパッケージ構造をつなげて考えられるようになるには，現場 / 現物での経験が必要になる. これらを次の開発メンバ育成からは進めていきたい.

対象的に，低次の処理を行うために必要な技能については，全くというほど使用しなかった.  これについては，煩雑なハードウェアの仕様を論理関係内に落とし込んでいく作業を省略できたという側面と同時に,
パッケージの提供されていないハードウェア / 処理について対応する能力の向上，端的に言うとドライバを書く能力については練習になっていないだろうという予測も立つ.

ROS システムを使用することはロボット開発を高速化する. ただし,
その高速化はある意味で 仕事の省略であり，教育という面からすると省略された部分からも学ぶべきところがあることは注意するべきかもしれない.

5. 今後の課題

 5.1 外装

FRPなどの一体成型型かつ防雨性のあるものを実装する. また，整備性 / 強度についても大いに考慮する,

 5.2 筐体

 重心位置と全高とのバランスを考慮した作りにする. また，センサ搭載位置の安定性に考慮する.

 5.3 センサ

複数搭載して，安定性を向上する. また，AMCL の 予備策となりうる手段を併用することで安定性を向上する.

 5.4開発体制

開発参加者の技量を向上する. また シミュレーションモデルの不在によりソフトウェアテストとハードウェアテストの独立化が図れなかった. これを改める.

6 結び

今回の開発に於いて，多数の人々の協力により出走まで漕ぎ着けることができましたことをここにお礼申し上げます.


\begin{thebibliography}{9}
  \bibitem{icart} "ロボットフレームi-Cart mini"，\\ http://t-frog.com/products/icart\_mini/
  \bibitem{ypspur} "移動ロボット走行制御コマンド系および走行制御系"，http://www.roboken.iit.tsukuba.ac.jp/\\platform/wiki/\_media/ypspur-0.13.2.pdf
\end{thebibliography}

\end{document}
